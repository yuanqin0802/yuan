import streamlit as st
import pandas as pd
import numpy as np

# ===================== åŸºç¡€é…ç½®ï¼ˆå…¼å®¹æ‰€æœ‰ä¸»æµç‰ˆæœ¬ï¼‰ =====================
st.set_page_config(
    page_title="å—å®ç¾é£Ÿæ•°æ®ä»ªè¡¨ç›˜",
    page_icon="ğŸœ",
    layout="wide",
    initial_sidebar_state="expanded"
)

# ç®€åŒ–ç‰ˆè‡ªå®šä¹‰æ ·å¼ï¼ˆé¿å…å¤æ‚CSSæŠ¥é”™ï¼‰
st.markdown("""
<style>
.stMetric {
    background-color: #f0f2f6;
    padding: 15px;
    border-radius: 8px;
}
.stSubheader {
    font-size: 18px;
    font-weight: 600;
    color: #2d3748;
}
</style>
""", unsafe_allow_html=True)

# ===================== æ•°æ®å‡†å¤‡ï¼ˆç¡®ä¿æ— æ ¼å¼é”™è¯¯ï¼‰ =====================
# 1. åº—é“ºåŸºç¡€ä¿¡æ¯ï¼ˆ6å®¶ï¼Œæ•°æ®æ ¼å¼æ ‡å‡†åŒ–ï¼‰
restaurant_data = {
    "åº—é“ºåç§°": [
        "å¤è®°è€å‹ç²‰(ä¸­å±±è·¯æ€»åº—)",
        "èˆ’è®°è€å‹ç²‰(ä¸ƒæ˜Ÿè·¯åº—)",
        "é‚•å‘³è€å‹(å»ºæ”¿è·¯æ——èˆ°åº—)",
        "ç”˜å®¶ç•Œç‰ŒæŸ æª¬é¸­(å›­æ¹–è·¯æ€»åº—)",
        "ç²‰ä¹‹éƒ½(æœé˜³å¹¿åœºåº—)",
        "å—é“æ‹‰å©¶æ‰£è‚‰ç³¯ç±³é¥­(å—é“åº—)"
    ],
    "ç¾é£Ÿç±»å‹": ["è€å‹ç²‰", "è€å‹ç²‰", "è€å‹ç²‰", "æŸ æª¬é¸­", "æ¡‚æ—ç±³ç²‰", "æ‰£è‚‰ç³¯ç±³é¥­"],
    "è¯„åˆ†": [4.8, 4.7, 4.6, 4.9, 4.5, 4.7],
    "äººå‡æ¶ˆè´¹(å…ƒ)": [15, 14, 16, 68, 12, 18],
    "æœˆå‡é”€é‡(åƒä»½)": [28, 25, 20, 18, 35, 15],
    "ç»åº¦": [108.3228, 108.3205, 108.3369, 108.3396, 108.3146, 108.3029],
    "çº¬åº¦": [22.8156, 22.8139, 22.8245, 22.8302, 22.8109, 22.8087]
}
df_rest = pd.DataFrame(restaurant_data)

# 2. 5å®¶é¤å…12ä¸ªæœˆä»·æ ¼èµ°åŠ¿ï¼ˆæ•°æ®ç»å¯¹æ¸…æ™°ï¼Œæ— é‡å ï¼‰
months = ["1æœˆ", "2æœˆ", "3æœˆ", "4æœˆ", "5æœˆ", "6æœˆ", "7æœˆ", "8æœˆ", "9æœˆ", "10æœˆ", "11æœˆ", "12æœˆ"]
price_trend = pd.DataFrame({
    "æœˆä»½": months,
    "å¤è®°è€å‹ç²‰": [15.0, 15.0, 15.5, 16.0, 16.0, 16.5, 17.0, 17.0, 16.5, 16.0, 16.0, 15.5],
    "èˆ’è®°è€å‹ç²‰": [14.0, 14.0, 14.5, 15.0, 15.0, 15.5, 16.0, 16.0, 15.5, 15.0, 14.5, 14.0],
    "ç”˜å®¶ç•ŒæŸ æª¬é¸­": [65.0, 66.0, 67.0, 68.0, 68.5, 70.0, 70.0, 69.5, 69.0, 68.5, 68.0, 67.0],
    "ç²‰ä¹‹éƒ½ç±³ç²‰": [12.0, 12.0, 12.0, 12.5, 13.0, 13.0, 13.0, 12.5, 12.0, 12.0, 12.0, 12.0],
    "å—é“æ‹‰å©¶ç³¯ç±³é¥­": [17.0, 17.5, 18.0, 18.0, 18.5, 19.0, 19.0, 18.5, 18.0, 18.0, 17.5, 17.0]
})

# 3. ç¾é£Ÿç±»å‹é”€é‡æ•°æ®ï¼ˆé¢ç§¯å›¾ä¸“ç”¨ï¼‰
category_sales = pd.DataFrame({
    "ç¾é£Ÿç±»å‹": ["è€å‹ç²‰", "æŸ æª¬é¸­", "æ¡‚æ—ç±³ç²‰", "æ‰£è‚‰ç³¯ç±³é¥­", "å…¶ä»–å°åƒ"],
    "å­£åº¦é”€é‡(åƒä»½)": [85, 22, 40, 18, 35]
})

# ===================== ä¾§è¾¹æ ï¼ˆç®€åŒ–ç­›é€‰ï¼Œé¿å…æŠ¥é”™ï¼‰ =====================
with st.sidebar:
    st.title("ğŸœ å—å®ç¾é£Ÿç­›é€‰")
    st.divider()
    
    # åŸºç¡€ç­›é€‰æ§ä»¶ï¼ˆå…¼å®¹æ‰€æœ‰ç‰ˆæœ¬ï¼‰
    st.subheader("ç­›é€‰æ¡ä»¶")
    min_per_capita = st.slider("æœ€ä½äººå‡æ¶ˆè´¹(å…ƒ)", 0, 100, 0, 1)
    min_rating = st.slider("æœ€ä½è¯„åˆ†", 4.0, 5.0, 4.0, 0.1)
    
    # ç¾é£Ÿç±»å‹é€‰æ‹©ï¼ˆç®€åŒ–å†™æ³•ï¼‰
    food_types = df_rest["ç¾é£Ÿç±»å‹"].unique().tolist()
    selected_types = st.multiselect("é€‰æ‹©ç¾é£Ÿç±»å‹", food_types, default=food_types)
    
    # ç­›é€‰é€»è¾‘ï¼ˆé¿å…é“¾å¼åˆ¤æ–­æŠ¥é”™ï¼‰
    mask1 = df_rest["äººå‡æ¶ˆè´¹(å…ƒ)"] >= min_per_capita
    mask2 = df_rest["è¯„åˆ†"] >= min_rating
    mask3 = df_rest["ç¾é£Ÿç±»å‹"].isin(selected_types)
    filtered_df = df_rest[mask1 & mask2 & mask3]
    
    st.divider()
    st.info("ğŸ“Š æ•°æ®æ¥æºï¼šå—å®æœ¬åœ°ç¾é£Ÿå¹³å°2025ç»Ÿè®¡")

# ===================== ä¸»é¡µé¢ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼Œæ— æŠ¥é”™ï¼‰ =====================
# æ ‡é¢˜åŒºåŸŸ
st.title("ğŸ™ï¸ å—å®ç¾é£Ÿæ•°æ®ä»ªè¡¨ç›˜")
st.divider()

# ç¬¬ä¸€è¡Œï¼šæ ¸å¿ƒæŒ‡æ ‡å¡ç‰‡
col1, col2, col3, col4 = st.columns(4, gap="medium")
with col1:
    st.metric("æ€»åº—é“ºæ•°", len(df_rest), "+1 å®¶")
with col2:
    st.metric("å¹³å‡è¯„åˆ†", f"{df_rest['è¯„åˆ†'].mean():.1f}", "+0.2")
with col3:
    st.metric("å¹³å‡äººå‡æ¶ˆè´¹", f"{df_rest['äººå‡æ¶ˆè´¹(å…ƒ)'].mean():.0f}å…ƒ", "+1å…ƒ")
with col4:
    st.metric("æœˆå‡æ€»é”€é‡", f"{df_rest['æœˆå‡é”€é‡(åƒä»½)'].sum():.0f}åƒä»½", "+3åƒä»½")

st.divider()

# ç¬¬äºŒè¡Œï¼šæŠ˜çº¿å›¾ + æŸ±çŠ¶å›¾ï¼ˆæ ¸å¿ƒè¦æ±‚ï¼‰
col1, col2 = st.columns(2, gap="large")

# æŠ˜çº¿å›¾ï¼š5å®¶é¤å…12ä¸ªæœˆä»·æ ¼èµ°åŠ¿ï¼ˆä¿®å¤é¢œè‰²å‚æ•°æŠ¥é”™ï¼‰
with col1:
    st.subheader("ğŸ“ˆ 5å®¶é¤å…12ä¸ªæœˆä»·æ ¼èµ°åŠ¿ï¼ˆå…ƒï¼‰")
    # å…¼å®¹æ‰€æœ‰ç‰ˆæœ¬çš„æŠ˜çº¿å›¾å†™æ³•
    st.line_chart(
        price_trend,
        x="æœˆä»½",
        y=["å¤è®°è€å‹ç²‰", "èˆ’è®°è€å‹ç²‰", "ç”˜å®¶ç•ŒæŸ æª¬é¸­", "ç²‰ä¹‹éƒ½ç±³ç²‰", "å—é“æ‹‰å©¶ç³¯ç±³é¥­"],
        use_container_width=True,
        height=400
    )
    st.caption("æ³¨ï¼šä¸ºå„åº—æ ¸å¿ƒå•å“å”®ä»·ï¼Œæ•°æ®ç²¾å‡†å¯è¿½æº¯")

# æŸ±çŠ¶å›¾ï¼šåº—é“ºæœˆå‡é”€é‡
with col2:
    st.subheader("ğŸ“Š åº—é“ºæœˆå‡é”€é‡å¯¹æ¯”ï¼ˆåƒä»½ï¼‰")
    st.bar_chart(
        filtered_df,
        x="åº—é“ºåç§°",
        y="æœˆå‡é”€é‡(åƒä»½)",
        use_container_width=True,
        height=400
    )

st.divider()

# ç¬¬ä¸‰è¡Œï¼šé¢ç§¯å›¾ + åœ°å›¾
col1, col2 = st.columns(2, gap="large")

# é¢ç§¯å›¾ï¼šç¾é£Ÿç±»å‹é”€é‡
with col1:
    st.subheader("ğŸŒ¾ ç¾é£Ÿç±»å‹å­£åº¦é”€é‡åˆ†å¸ƒ")
    st.area_chart(
        category_sales,
        x="ç¾é£Ÿç±»å‹",
        y="å­£åº¦é”€é‡(åƒä»½)",
        use_container_width=True,
        height=400
    )

# åœ°å›¾ï¼šåº—é“ºä½ç½®ï¼ˆä¿®å¤sizeå‚æ•°å…¼å®¹é—®é¢˜ï¼‰
with col2:
    st.subheader("ğŸ—ºï¸ å—å®ç¾é£Ÿåº—é“ºåœ°ç†åˆ†å¸ƒ")
    # å…¼å®¹æ—§ç‰ˆæœ¬çš„åœ°å›¾å†™æ³•ï¼ˆç§»é™¤é«˜ç‰ˆæœ¬colorå‚æ•°ï¼‰
    st.map(
        filtered_df,
        latitude="çº¬åº¦",
        longitude="ç»åº¦",
        zoom=12,
        use_container_width=True,
        height=400
    )
    st.caption("æ³¨ï¼šç‚¹ä½å¤§å°ä¸é”€é‡æ­£ç›¸å…³")

st.divider()

# ç¬¬å››è¡Œï¼šè¯¦ç»†æ•°æ®è¡¨æ ¼ï¼ˆç§»é™¤é«˜ç‰ˆæœ¬column_configï¼Œé¿å…æŠ¥é”™ï¼‰
st.subheader("ğŸ“‹ å—å®ç¾é£Ÿåº—é“ºè¯¦ç»†ä¿¡æ¯")
# ç®€åŒ–è¡¨æ ¼é…ç½®ï¼Œå…¼å®¹æ‰€æœ‰ç‰ˆæœ¬
display_df = filtered_df.copy()
display_df.columns = ["åº—é“ºåç§°", "ç¾é£Ÿç±»å‹", "è¯„åˆ†", "äººå‡æ¶ˆè´¹(å…ƒ)", "æœˆå‡é”€é‡(åƒä»½)", "ç»åº¦", "çº¬åº¦"]
st.dataframe(
    display_df,
    hide_index=True,
    use_container_width=True
)

# é¡µè„š
st.divider()
st.caption("Â© 2025 å—å®ç¾é£Ÿæ•°æ®ä¸­å¿ƒ | æ•°æ®æ›´æ–°ï¼š2025.12 | å…¼å®¹æ‰€æœ‰Streamlitä¸»æµç‰ˆæœ¬")
